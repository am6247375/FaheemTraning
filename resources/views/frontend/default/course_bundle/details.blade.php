@extends('layouts.default')
@push('title', get_phrase('Course Bundle details'))
@push('meta')@endpush

@section('content')
    <!---------- Bread Crumb Area Start ---------->
    <section class="breadcum-area">
        <div class="container">
            <div class="row">
                <div class="col-lg-12">
                    <div class="eNtry-breadcum mt-5">
                        <nav aria-label="breadcrumb">
                            <ol class="breadcrumb">
                                <li class="breadcrumb-item"><a href="#">{{ get_phrase('Home') }}</a></li>
                                <li class="breadcrumb-item active" aria-current="page">{{ get_phrase('Course Bundle Details') }}</li>
                            </ol>
                        </nav>
                    </div>
                </div>
            </div>
            <div class="col-md-8">
                <h1 class="bundle-details-title">{{ $bundle->title }}</h1>
                <p class="bundle-details-description">{{ \Illuminate\Support\Str::limit(strip_tags($bundle->bundle_details), 120) }}</p>

                <div class="d-flex align-items-center mt-4 gap-4">
                    <div class="d-flex align-items-center gap-2">
                        <img class="bundle-details user-image rounded-circle object-fit-cover me-1" src="{{ get_image($bundle->user_id) }}">
                        <p class="bundle-details user-name">
                            {{ \App\Models\User::find($bundle->user_id)?->name ?? 'Unknown' }}
                        </p>
                    </div> |

                    <div class="d-flex align-items-center gap-2">
                        <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path
                                d="M3.75772 17.5837C3.38261 17.5837 3.06554 17.4542 2.80651 17.1951C2.54748 16.9361 2.41797 16.619 2.41797 16.2439V8.75679C2.41797 8.38168 2.54748 8.06461 2.80651 7.80558C3.06554 7.54656 3.38261 7.41704 3.75772 7.41704H16.2448C16.62 7.41704 16.937 7.54656 17.1961 7.80558C17.4551 8.06461 17.5846 8.38168 17.5846 8.75679V16.2439C17.5846 16.619 17.4551 16.9361 17.1961 17.1951C16.937 17.4542 16.62 17.5837 16.2448 17.5837H3.75772ZM3.75772 16.5004H16.2448C16.309 16.5004 16.3677 16.4736 16.4212 16.4202C16.4746 16.3668 16.5013 16.308 16.5013 16.2439V8.75679C16.5013 8.69268 16.4746 8.63391 16.4212 8.58048C16.3677 8.52706 16.309 8.50035 16.2448 8.50035H3.75772C3.69361 8.50035 3.63484 8.52706 3.58141 8.58048C3.52799 8.63391 3.50128 8.69268 3.50128 8.75679V16.2439C3.50128 16.308 3.52799 16.3668 3.58141 16.4202C3.63484 16.4736 3.69361 16.5004 3.75772 16.5004ZM9.22886 15.0308L12.7016 12.7728C12.802 12.7037 12.8522 12.6117 12.8522 12.4966C12.8522 12.3816 12.802 12.292 12.7016 12.2279L9.22886 9.96994C9.11455 9.89729 8.99943 9.89183 8.88351 9.95356C8.76759 10.0153 8.70964 10.1142 8.70964 10.2504V14.7503C8.70964 14.8865 8.76759 14.9854 8.88351 15.0471C8.99943 15.1089 9.11455 15.1034 9.22886 15.0308ZM4.75736 6.09652C4.60374 6.09652 4.47405 6.0451 4.36828 5.94225C4.26252 5.8394 4.20964 5.71174 4.20964 5.55925C4.20964 5.40677 4.26143 5.27763 4.36503 5.17185C4.46864 5.06609 4.59726 5.01321 4.75089 5.01321H15.2452C15.3988 5.01321 15.5285 5.06463 15.6343 5.16748C15.74 5.27033 15.7929 5.39799 15.7929 5.55048C15.7929 5.70297 15.7411 5.8321 15.6375 5.93788C15.5339 6.04364 15.4053 6.09652 15.2517 6.09652H4.75736ZM6.75128 3.69267C6.59755 3.69267 6.46884 3.64125 6.36516 3.53842C6.26148 3.43557 6.20964 3.3079 6.20964 3.15542C6.20964 3.00292 6.26148 2.87379 6.36516 2.76802C6.46884 2.66226 6.59755 2.60938 6.75128 2.60938H13.2513C13.405 2.60938 13.5337 2.6608 13.6374 2.76365C13.7411 2.86648 13.7929 2.99415 13.7929 3.14665C13.7929 3.29913 13.7411 3.42826 13.6374 3.53402C13.5337 3.63979 13.405 3.69267 13.2513 3.69267H6.75128Z"
                                fill="#192335" />
                        </svg>
                        <p class="bundle-details course-count">
                            {{ count(json_decode($bundle->course_ids, true) ?? []) }} {{ get_phrase('courses') }}
                        </p>
                    </div> |

                    <div class="d-flex align-items-center gap-2">
                        <div class="icon">
                            <ul class="d-flex align-items-center">
                                @for ($i = 1; $i <= 5; $i++)
                                    @if ($i <= $average_rating)
                                        <li class="me-0"><i class="fa-solid fa-star text-15px mt-7px text-warning"></i></li>
                                    @else
                                        <li class="me-0"><i class="fa-solid fa-star text-light text-15px mt-7px"></i></li>
                                    @endif
                                @endfor
                            </ul>
                        </div>
                        <p class="bundle-details course-count">
                            {{ $ratings->count() }} {{ get_phrase('reviews') }}
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </section>
    <!---------- Bread Crumb Area End ---------->

    <!-- Start Instructor -->
    <section>
        <div class="container">
            <div class="row g-4">
                <div class="col-lg-8">
                    <div class="bundle-details courses">
                        @foreach ($courses as $course)
                            @php
                                $lessons = $course->lessons;
                                $instructor_details = $course->instructor;
                                $total_rating = $course->ratings ? $course->ratings->sum('rating') : 0;
                                $number_of_ratings = $course->ratings ? $course->ratings->count() : 0;
                                $average_ceil_rating = $number_of_ratings > 0 ? ceil($total_rating / $number_of_ratings) : 0;
                            @endphp
                            <!-- Course List Card -->
                            <a href="{{ route('course.details', [$course->slug, $course->id]) }}" class="d-flex course-list-card w-100">
                                <div class="course-thumbnail">
                                    <img src="{{ get_image($course->thumbnail ?? '') }}" alt="">


                                </div>
                                <div class="course-details w-100">
                                    <div class="d-flex align-items-center justify-content-between">
                                        <h5 class="title">{{ $course->title }}</h5>
                                    </div>
                                    <div class="d-flex align-items-center gap-4">
                                        <p class="course-info">
                                            <span>
                                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20" fill="none">
                                                    <path
                                                        d="M12.6509 9.54004L14.8464 8.27081C14.9746 8.19549 15.0387 8.08879 15.0387 7.95071C15.0387 7.81263 14.9746 7.70458 14.8464 7.62658L12.6509 6.35735C12.5383 6.29326 12.4132 6.26121 12.2756 6.26121C12.138 6.26121 12.012 6.29326 11.8977 6.35735L9.70222 7.62658C9.57401 7.7019 9.50991 7.8086 9.50991 7.94669C9.50991 8.08479 9.57401 8.19283 9.70222 8.27081L11.8977 9.54004C12.0103 9.60414 12.1354 9.63619 12.273 9.63619C12.4106 9.63619 12.5366 9.60414 12.6509 9.54004ZM12.6509 11.9968L14.1253 11.1554C14.2383 11.0928 14.3293 11.0021 14.3983 10.8832C14.4674 10.7643 14.5019 10.636 14.5019 10.4984V9.32371L12.6509 10.399C12.5379 10.4685 12.4124 10.5032 12.2743 10.5032C12.1362 10.5032 12.0107 10.4685 11.8977 10.399L10.0468 9.32371V10.4984C10.0468 10.636 10.0813 10.7643 10.1503 10.8832C10.2194 11.0021 10.3104 11.0928 10.4234 11.1554L11.8977 11.9968C12.0103 12.0609 12.1354 12.0929 12.273 12.0929C12.4106 12.0929 12.5366 12.0609 12.6509 11.9968ZM16.4089 16.25H12.2743C12.2743 16.0416 12.2672 15.8333 12.2531 15.625C12.2389 15.4166 12.2177 15.2083 12.1894 15H16.4089C16.4837 15 16.5451 14.9759 16.5932 14.9279C16.6413 14.8798 16.6653 14.8183 16.6653 14.7435V5.25642C16.6653 5.18163 16.6413 5.12019 16.5932 5.0721C16.5451 5.02402 16.4837 4.99998 16.4089 4.99998H3.58845C3.51366 4.99998 3.45222 5.02402 3.40414 5.0721C3.35605 5.12019 3.33201 5.18163 3.33201 5.25642V6.14263C3.12368 6.11431 2.91535 6.09307 2.70703 6.07892C2.4987 6.06476 2.29036 6.05769 2.08203 6.05769V5.25642C2.08203 4.84215 2.22954 4.48752 2.52455 4.19252C2.81955 3.89751 3.17418 3.75 3.58845 3.75H16.4089C16.8232 3.75 17.1778 3.89751 17.4728 4.19252C17.7678 4.48752 17.9153 4.84215 17.9153 5.25642V14.7435C17.9153 15.1578 17.7678 15.5124 17.4728 15.8074C17.1778 16.1025 16.8232 16.25 16.4089 16.25ZM6.58376 16.25C6.41593 16.25 6.27005 16.1973 6.14611 16.0921C6.02218 15.9869 5.94473 15.8498 5.91376 15.681C5.79302 14.8274 5.4247 14.1017 4.80878 13.504C4.19286 12.9062 3.45542 12.5443 2.59645 12.4182C2.4357 12.3974 2.30977 12.3219 2.21868 12.1917C2.12758 12.0615 2.08203 11.913 2.08203 11.7464C2.08203 11.5693 2.1424 11.4209 2.26314 11.3013C2.38386 11.1816 2.52434 11.133 2.68459 11.1555C3.86727 11.2901 4.87501 11.7759 5.7078 12.613C6.54059 13.45 7.0259 14.4599 7.16372 15.6426C7.18615 15.8114 7.13968 15.9548 7.0243 16.0729C6.90891 16.1909 6.76207 16.25 6.58376 16.25ZM9.82239 16.25C9.63969 16.25 9.48985 16.1869 9.37287 16.0609C9.25589 15.9348 9.18618 15.7777 9.16374 15.5897C9.00135 13.86 8.30905 12.3918 7.08682 11.1851C5.8646 9.97834 4.38598 9.3034 2.65095 9.16023C2.48214 9.14313 2.34512 9.07206 2.23989 8.94702C2.13465 8.82197 2.08203 8.67607 2.08203 8.50933C2.08203 8.33217 2.14026 8.18162 2.25672 8.05769C2.37316 7.93377 2.51418 7.88035 2.67978 7.89744C4.76098 8.0406 6.53153 8.84135 7.99145 10.2997C9.45138 11.758 10.2615 13.5235 10.4217 15.5961C10.4388 15.7788 10.3875 15.9334 10.2677 16.06C10.1479 16.1867 9.99947 16.25 9.82239 16.25ZM2.93093 16.25C2.69298 16.25 2.49202 16.1678 2.32803 16.0035C2.16403 15.8392 2.08203 15.6381 2.08203 15.4001C2.08203 15.1622 2.16418 14.9612 2.32849 14.7972C2.49278 14.6332 2.6939 14.5512 2.93184 14.5512C3.16979 14.5512 3.37075 14.6334 3.53474 14.7977C3.69874 14.962 3.78074 15.1631 3.78074 15.4011C3.78074 15.639 3.69859 15.84 3.53428 16.004C3.36999 16.168 3.16887 16.25 2.93093 16.25Z"
                                                        fill="#6B7385" />
                                                </svg>
                                            </span>
                                            {{ $lessons->count() }} {{ get_phrase('lessons') }}
                                        </p>
                                        <p class="course-info">
                                            <span>
                                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20" fill="none">
                                                    <path
                                                        d="M4.16667 16.6663C3.70833 16.6663 3.31597 16.5031 2.98958 16.1768C2.66319 15.8504 2.5 15.458 2.5 14.9997V4.99967C2.5 4.54134 2.66319 4.14898 2.98958 3.82259C3.31597 3.4962 3.70833 3.33301 4.16667 3.33301H15.8333C16.2917 3.33301 16.684 3.4962 17.0104 3.82259C17.3368 4.14898 17.5 4.54134 17.5 4.99967V14.9997C17.5 15.458 17.3368 15.8504 17.0104 16.1768C16.684 16.5031 16.2917 16.6663 15.8333 16.6663H4.16667ZM4.16667 14.9997H15.8333V4.99967H4.16667V14.9997ZM5.83333 12.4997H8.33333C8.56944 12.4997 8.76736 12.4198 8.92708 12.2601C9.08681 12.1004 9.16667 11.9025 9.16667 11.6663V11.2497C9.16667 11.1247 9.125 11.0205 9.04167 10.9372C8.95833 10.8538 8.85417 10.8122 8.72917 10.8122H8.35417C8.22917 10.8122 8.125 10.8538 8.04167 10.9372C7.95833 11.0205 7.91667 11.1247 7.91667 11.2497H6.25V8.74967H7.91667C7.91667 8.87467 7.95833 8.97884 8.04167 9.06217C8.125 9.14551 8.22917 9.18717 8.35417 9.18717H8.72917C8.85417 9.18717 8.95833 9.14551 9.04167 9.06217C9.125 8.97884 9.16667 8.87467 9.16667 8.74967V8.33301C9.16667 8.0969 9.08681 7.89898 8.92708 7.73926C8.76736 7.57954 8.56944 7.49967 8.33333 7.49967H5.83333C5.59722 7.49967 5.39931 7.57954 5.23958 7.73926C5.07986 7.89898 5 8.0969 5 8.33301V11.6663C5 11.9025 5.07986 12.1004 5.23958 12.2601C5.39931 12.4198 5.59722 12.4997 5.83333 12.4997ZM14.1667 7.49967H11.6667C11.4306 7.49967 11.2326 7.57954 11.0729 7.73926C10.9132 7.89898 10.8333 8.0969 10.8333 8.33301V11.6663C10.8333 11.9025 10.9132 12.1004 11.0729 12.2601C11.2326 12.4198 11.4306 12.4997 11.6667 12.4997H14.1667C14.4028 12.4997 14.6007 12.4198 14.7604 12.2601C14.9201 12.1004 15 11.9025 15 11.6663V11.2497C15 11.1247 14.9583 11.0205 14.875 10.9372C14.7917 10.8538 14.6875 10.8122 14.5625 10.8122H14.1875C14.0625 10.8122 13.9583 10.8538 13.875 10.9372C13.7917 11.0205 13.75 11.1247 13.75 11.2497H12.0833V8.74967H13.75C13.75 8.87467 13.7917 8.97884 13.875 9.06217C13.9583 9.14551 14.0625 9.18717 14.1875 9.18717H14.5625C14.6875 9.18717 14.7917 9.14551 14.875 9.06217C14.9583 8.97884 15 8.87467 15 8.74967V8.33301C15 8.0969 14.9201 7.89898 14.7604 7.73926C14.6007 7.57954 14.4028 7.49967 14.1667 7.49967Z"
                                                        fill="#6B7385" />
                                                </svg>
                                            </span>{{ $course->language }}
                                        </p>

                                    </div>
                                    <p class="description">{{ $course->short_description }}</p>
                                    <div class="d-flex align-items-center gap-1 mt-3">
                                        <img class="bundle-details user-image rounded-circle object-fit-cover me-1" src="{{ get_image($course->user_id) }}">
                                        <p class="bundle-details user-name">
                                            {{ \App\Models\User::find($course->user_id)?->name ?? 'Unknown' }}
                                        </p>
                                    </div>
                                    {{-- <div class="review-icon">
                                        <p>{{ $average_ceil_rating }}</p>
                                        <p><i class="fa-solid fa-star {{ $number_of_ratings > 0 ? 'filled' : '' }}"></i></p>
                                        <p>({{ $number_of_ratings }} {{ get_phrase('Reviews') }})</p>
                                    </div> --}}

                                </div>
                            </a>
                            <!-- End Course List Card -->
                        @endforeach

                        <div class="overview">
                            <h4>{{ get_phrase('Description') }}</h4>
                            <p>{!! $bundle->bundle_details !!}</p>
                        </div>

                        <div class="review">
                            <h4>{{ get_phrase('Reviews') }}</h4>
                            <div class="row">
                                <div class="col-md-12">
                                    @foreach ($ratings as $rating)
                                        <div class="reviews-border" id="userReview{{ $rating->id }}">
                                            <div class="row {{ $loop->index >= 1 ? 'border-top' : '' }}">
                                                <div class=" " style="padding: 20px 0">
                                                    <div class="d-flex justify-content-between">
                                                        <div class="review-user d-flex align-items-center gap-3">
                                                            <img class="rounded-circle object-fit-cover me-1" src="{{ get_image($bundle->user_id) }}">
                                                            <span>
                                                                <p class="bundle-details user-name">
                                                                    {{ \App\Models\User::find($rating->user_id)?->name ?? 'Unknown' }}
                                                                </p>
                                                                <div class="icon">
                                                                    @for ($i = 1; $i <= 5; $i++)
                                                                        @if ($rating->rating >= $i)
                                                                            <i class="fa-solid fa-star text-warning"></i>
                                                                        @else
                                                                            <i class="fa-solid fa-star"></i>
                                                                        @endif
                                                                    @endfor
                                                                </div>
                                                            </span>
                                                        </div>
                                                        <p class="text-center my-0">{{ $rating->created_at->format('d-M-Y') }}</p>
                                                    </div>

                                                </div>
                                                <div class="description">
                                                    <p>{{ $rating->comment }}</p>
                                                </div>
                                            </div>
                                        </div>
                                    @endforeach
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-lg-4 px-4">
                    @include('frontend.default.course_bundle.pricing_card')
                </div>
            </div>
        </div>
    </section>
    <!-- End Instructor -->
@endsection
